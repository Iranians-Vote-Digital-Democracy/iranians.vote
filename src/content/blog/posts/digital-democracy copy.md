---
id: 5
title: "hihi hi"
excerpt: "this is excerpt"
---

## افرازِ آزادی
#### راه‌کاری برای رای گیری الکترونیکیِ محرمانهِ و ناشناس و آزاد

دی‌ ماه ۱۴۰۲

### چکیده

در این مستند، تمرکز اصلی ما بر توضیح روشی است که به ما اجازه می‌دهد یک زیرساخت محرمانه و آزاد برای رای‌گیری با حفظ ناشناسی افراد داشته باشیم. همچنین در این زیرساخت، ما نیاز داریم که از سن و ملیت شرکت‌کنندگان به‌صورت ناشناس مطلع و مطمئن شویم. این مراحل به چند بخش تقسیم می‌شوند و شامل مراحل کلیدی مختلفی هستند:

- ایجاد پروفایل دیجیتال برای کاربران با استفاده از پاسپورت‌های بیومتریک به عنوان شناسه‌های پروفایل.
- احراز صلاحیت و اعتبار سنجی پاسپورت افراد با کمک تکنولوژی اثبات‌های دانش صفر (ZKP).

با استفاده از تکنولوژی اثبات‌های دانش صفر (ZKP) که در ادامه مستند به آن می‌پردازیم، هیچ ارتباط مستقیمی بین پروفایل دیجیتال کاربر و پاسپورت و شخصیت حقیقی آن فرد وجود نخواهد داشت. همچنین این پروتکل، مسائل مربوط به راه‌اندازی قراردادهای هوشمند مرتبط با رأی‌گیری و فرآیندهای مورد نیاز برای این زیرساخت را نیز پوشش می‌دهد.

### فهرست مطالب
1. مقدمه
2. چرا پاسپورت
   - 2.1 پاسپورت‌های الکترونیکی چگونه کار می‌کنند
3. ساخت صفحه کاربری
   - 3.1 اعتبار سنجی و احراز هویت پاسپورت
   - 3.2 ساخت کلیدهای دیجیتالی مرتبط با هویت دیجیتال محرمانه
4. دریافت گواهی واجد شرایط بودن دیجیتال قابل تأیید با حفظ ناشناسی افراد
5. قراردادهای هوشمند
   - 5.1 معماری قراردادها
   - 5.2 اطلاعات مورد نیاز برای رأی دادن
6. تسهیل‌ کنندگان ارتباط با بلاکچین
   - 6.1 سود تسهیل‌کنندگان
7. چگونگی اعلام علاقه برای شرکت در یک انتخابات
8. اثبات درست بودن پاسپورت به صورت محرمانه
9. فرآیند رای دادن
   - 9.1 محاسبه نتیجه نهایی
10. مفروضات و نکته‌های مرتبط با امنیت پروتکل

### مقدمه

در عصر دیجیتال امروز، پیشرفت‌های فناوری به طور قابل توجهی توانایی ما در توسعه سیستم‌هایی که به بیان نظرات جمعی مردم کمک می‌کنند را افزایش داده است. این مقاله به بررسی توسعه یک سیستم رأی‌گیری دیجیتال قوی با بهره‌گیری از روش‌ها و چارچوب‌های پیشرفته فناوری می‌پردازد.

هدف ما ایجاد راه‌حل‌هایی است که به مردم امکان می‌دهد نظرات خود را به راحتی و با امنیت در فرآیند دموکراتیک بیان کنند. این مقاله به معرفی سیستمی می‌پردازد که از اطلاعات پاسپورت بیومتریک برای ایجاد پروفایل‌های رأی‌دهندگان استفاده می‌کند. همچنین از تکنولوژی اثبات‌های دانش صفر (ZKP) برای اطمینان از محرمانگی و درست بودن هویت رأی‌دهندگان به صورت ناشناس بهره می‌برد.

در این مقاله، به جزئیات مربوط به راه‌اندازی نظرسنجی‌ها، پیچیدگی‌های فرآیند رأی‌گیری و تکنیک‌های مورد استفاده برای محاسبه نتایج می‌پردازیم. در نهایت، با بررسی دقیق ادعاها و فرضیات امنیتی، تلاش می‌کنیم تا بالاترین سطح یکپارچگی و امنیت را در طول فرآیند رأی‌گیری تضمین کنیم.

----

### چرا پاسپورت

سیستم‌های رأی‌گیری باید به منابع معتبری برای تأیید صحت، یکتایی و صلاحیت رأی‌دهندگان متکی باشند. پیدا کردن منبعی که هر سه ویژگی را تایید کند، به ویژه در انتخابات در کشورهایی با حکومت‌های استبدادی، چالش‌برانگیز است. به عنوان مثال، در انتخابات دولتی:

- یکتایی و اصالت می‌تواند با استفاده از داده‌های بیومتریک تأیید شود.
- احراز صلاحیت (شهروندی و سن) مشکل‌تر است زیرا تنها منبع تأیید چنین پارامترهایی دولت است.

پاسپورت بیومتریک به عنوان ابزاری برای تامین سه ویژگی اصلی سیستم‌های رأی‌گیری عمل می‌کند. در بخش‌های بعدی به نگرانی‌های مربوط به جعل پاسپورت و پاسپورت‌های صادر شده توسط دولت پرداخت خواهد شد.

پاسپورت‌های بیومتریک دارای یک چیپ یا تراشه هستند که حاوی اطلاعات مختلفی از جمله اطلاعات مرتبط با رمزنگاری و اطلاعات شخصی کاربر می‌باشد. 

اینجا فرصتی وجود دارد تا اطلاعات مرتبط با رمزنگاری داخل تراشه‌های پاسپورت‌ها را با تکنولوژی‌های اثبات دانش صفر ترکیب کنیم. به این ترتیب، می‌توانیم ثابت کنیم که من شهروند ایران هستم و بالای ۱۸ سال سن دارم بدون اینکه اطلاعات اصلی پاسپورت و هویت اصلی خود را آشکار کنم. در ادامه، به بررسی این موضوع خواهیم پرداخت که چگونه می‌توان این کار را انجام داد.

با استفاده از اثبات‌های دانش صفر (Zero Knowledge Proof)، می‌توانیم دانشی را ثابت کنیم بدون اینکه آن را آشکار کنیم. 🕵️‍♂️  
اگر این جمله برای شما نامفهوم هست، حق دارید ZKP یک شاخه نسبتا جدید در علم رمزنگاری است و اگر علاقه مند هستید به این که مطلع شوید این الگوریتم ها چگونه کار میکند و ما چجوری میتونیم از درستی کارکرد آنها اطمینان حاصل کنیم میتوانید از لینک های زیر استفاده کنید.

#### لینک‌های مرتبط با اثبات دانش صفر

- [اثبات دانش صفر در ویکی‌پدیا](https://en.wikipedia.org/wiki/Zero-knowledge_proof)
- [مقدمه‌ای بر اثبات دانش صفر](https://z.cash/learn/what-are-zero-knowledge-proofs/)
- [دوره آموزشی اثبات دانش صفر](https://zk-learning.org/)

---

### پاسپورت‌های الکترونیکی چگونه کار می‌کنند

پاسپورت‌های بیومتریک دارای یک تراشه هستند که شامل اطلاعات مختلفی از جمله اطلاعات رمزنگاری و اطلاعات شخصی کاربر می‌باشد. این اطلاعات به دو دسته اصلی تقسیم می‌شوند:

- اطلاعات رمزنگاری: شامل امضاهای دیجیتال و داده‌های امنیتی که برای تأیید صحت و اصالت پاسپورت استفاده می‌شوند.
- اطلاعات شخصی کاربر: شامل نام، تاریخ تولد، ملیت، شماره پاسپورت و سایر اطلاعات شناسایی که بر روی صفحه داده‌های پاسپورت چاپ شده است.

پاسپورت‌های بیومتریک براساس استانداردهای سازمان بین‌المللی هواپیمایی کشوری (ICAO) طراحی شده‌اند. این استانداردها، که به عنوان Doc 9303 شناخته می‌شوند، مشخصات فنی برای اسناد مسافرتی قابل خواندن توسط ماشین از جمله پاسپورت‌های الکترونیکی را تعیین می‌کنند.

#### رمزنگاری کلید عمومی

یکی از مبانی اساسی رمزنگاری، استفاده از رمزنگاری کلید عمومی است. در این سیستم، هر کاربر دارای دو کلید است: یک کلید عمومی که می‌تواند به اشتراک گذاشته شود و یک کلید خصوصی که باید محرمانه بماند. اطلاعات رمزنگاری شده با کلید عمومی فقط با استفاده از کلید خصوصی متناظر آن قابل رمزگشایی هستند. این فناوری در بسیاری از حوزه‌ها از جمله پروتکل HTTPS در وب، آدرس‌های ارزهای دیجیتال، و پاسپورت‌های بیومتریک کاربرد دارد.

برای مطالعه بیشتر در مورد رمزنگاری کلید عمومی، می‌توانید به لینک‌های زیر مراجعه کنید:

- [رمزنگاری کلید عمومی در ویکی‌پدیا](https://en.wikipedia.org/wiki/Public-key_cryptography)


#### PKD (دایرکتوری کلید عمومی) و نقش آن در امنیت پاسپورت‌های الکترونیکی

یکی از اجزای کلیدی این استاندارد، استفاده از دایرکتوری کلید عمومی (PKD) است. PKD یک سیستم مرکزی است که کلیدهای عمومی معتبر صادر شده توسط کشورهای مختلف را ذخیره می‌کند. این کلیدها برای تایید امضاهای دیجیتال بر روی پاسپورت‌های الکترونیکی استفاده می‌شوند و اطمینان می‌دهند که پاسپورت توسط مرجع صادر کننده معتبر صادر شده است.

![Your Image Description](images/tech-doc-en/11.png)
*منبع: [APrimeronthePublicKeyDirectory.pdf](https://www.icao.int/Security/FAL/PKD/Documents/APrimeronthePublicKeyDirectory(includeslanguageversion(s))/APrimeronthePublicKeyDirectory.pdf)*

#### مراحل اصلی خواندن و رمزگشایی داده‌های پاسپورت

فرض کنید در فرودگاه هستید و پاسپورت خود را به مأمور مرزی تحویل می‌دهید و مأمور آن را روی دستگاهی می‌گذارد که هم اسکنر دارد و هم خواننده NFC. چه اتفاقی در داخل آن ماشین برای تایید درست بودن پاسپورت می‌افتد؟

1. **دریافت داده‌های پایه پاسپورت از منطقه قابل خواندن توسط ماشین (MRZ) و تولید کلیدهای احراز هویت:**
   - دستگاه با استفاده از دوربین، داده‌های MRZ پاسپورت را اسکن می‌کند. MRZ بخش پایینی صفحه اول پاسپورت است که شامل حروف و اعداد خاصی می‌باشد.
   - دستگاه از این داده‌ها برای تولید کلیدهای دسترسی پایه (Kenc و Kmac) استفاده می‌کند.
   - دستگاه و تراشه پاسپورت کلیدها را به یکدیگر احراز هویت می‌کنند و کلیدهای جلسه (KSEnc و KSMAC) را استخراج می‌کنند.
   
2. **اسکن و رمزگشایی داده‌ها از تراشه پاسپورت:**
   - دستگاه با استفاده از NFC داده‌های تراشه پاسپورت را می‌خواند.
   - داده‌های داخل تراشه رمزنگاری شده هستند که با استفاده از کلیدهایی که در مرحله قبل به دست آمده بود این اطلاعات را رمزگشایی می‌کنند و به داده‌هایی مانند امضای نهاد صادر کننده روی هش بخش‌های اطلاعاتی مختلف دست پیدا می‌کنند.
   - بخش اطلاعاتی امضا شده (SOD) نهاد صادر کننده پاسپورت (CDS) را می‌خواند. این‌ها امضاهای دیجیتال و کلید عمومی مرجع صدور پاسپورت هستند.
   - دستگاه باید کلید عمومی خوانده شده نهاد صادر کننده را از PKD بخواند و امضای نهاد صادر کننده را چک کند.
   - دستگاه گروه‌های داده (DGs) را از پاسپورت می‌خواند.
   - دستگاه صحت تمام DG ها را با مقایسه هش‌های DGها با مقدارهای هش در SOD تأیید می‌کند.

<img src="images/tech-doc-en/1.png"/>

کشورهای عضو این استاندارد کلیدهای عمومی خود را در PKD ثبت می‌کنند. این کلید برای تایید امضاهای دیجیتال پاسپورت‌های صادر شده توسط آن کشور استفاده می‌شود.

اگر تمام تأییدها به درستی انجام شود، پاسپورت معتبر است و دستگاه داده‌های زیر را ذخیره می‌کند:

- **DG1:** جزئیات شخصی. شامل اطلاعات اصلی هویت دارنده پاسپورت مانند نام، تاریخ تولد، ملیت و شماره پاسپورت.
- **DG2:** عکس چهره. شامل عکس پرتره دارنده پاسپورت.
- **DG7:** امضا/تصویر دارنده. شامل تصویر امضای دست‌نویس دارنده پاسپورت.
- **DG15:** کلید عمومی احراز هویت فعال.
- مقدارهای هش سایر DGها.
- امضای سند که SOD را پوشش می‌دهد.
- گواهی امضا کننده سند (CDS).

 در مورد پروتکل ما، تمام اقدامات در این فرآیند به صورت محلی و بدون دسترسی به اینترنت در تلفن همراه شما انجام می‌شود و این اطلاعات به سرور یا محلی خارج از تلفن همراه شما فرستاده نمی‌شود و از آنجایی که نرم‌افزارهای منتشر شده متن‌باز هستند، هر کسی توانایی صحت‌سنجی این ادعا را دارد. 🚀

هیچ داده شخصی به هیچ جا ارسال نمی‌شود یا توسط هیچ طرف خارجی قابل دسترسی نیست.

### اثبات‌های دانش صفر (ZKP) و نقش آن در تایید اعتبار

اثبات‌های دانش صفر (ZKP) زیرمجموعه‌ای از محاسبات قابل تأیید (verifiable computation) است که به گونه‌ای طراحی شده است که فقط داده‌های انتخابی از فرآیند را فاش می‌کند و نه همه داده‌ها. اکنون که می‌دانید تراشه‌های پاسپورت حاوی چه داده‌هایی هستند، برای اعمال ZKP بر روی این داده‌ها به منظور اثبات اینکه پاسپورت معتبر با معیارهای خاصی داریم، باید بگوییم دقیقا چه ادعا محاسباتی را می‌خواهیم اثبات کنیم.

ادعای ما می‌تواند به مراحل فرآیند در محاسبات مرتبط باشد. برای مثال، ادعا می‌تواند همچین جمله‌ای باشد: “من پاسپورتی دارم که معیارهای خاصی مانند ملیت و سن را رعایت می‌کند و هنگامی که محاسبات قابل تأیید انجام شد، امضا با PKD اعتبارسنجی شد و امضای SOD نیز معتبر بود” و برای این ادعا می‌توان یک اثبات ZKP ایجاد کرد و هر فردی از طریق این اثبات می‌تواند به صحت ادعا اطمینان حاصل کند بدون دسترسی داشتن به اصل اطلاعات و ریاضیات پشت ZKP این مسئله را حاصل می‌نماید.

(در پیاده‌سازی، به دلیل این که محاسبات تولید اثبات ZKP به شدت سنگین و نیازمند CPUهای قدرت‌مندی هست، ممکن است کاربر تصمیم بگیرد تا محاسبات این اثبات را با داده‌های ایمنی که به حریم خصوصی او آسیبی نمی‌زند به یک شخص ثالث مانند ارائه‌دهنده هویت واگذار کند که در بخش‌های بعدی به آن خواهیم پرداخت.) 🤖

---

> **ما پیشنهاد می‌کنیم که برای پیگیری توضیحات فنی، از [نسخه انگلیسی مستند](https://freedomtool.org/#/doc) استفاده کنید، زیرا نوشتن چنین مستنداتی از کلمات تخصصی زیادی استفاده می‌کند و ممکن است شما به اندازه کافی با معادل فارسی این کلمات آشنا نباشید، اما ما تمام تلاش خود را در ترجمه فارسی انجام می‌دهیم.**

---

### 3. ساخت صفحه کاربری

از آنجایی که این سیستم یک سیستم رأی‌گیری الکترونیکی است، نیازمند آن هستیم که کاربران در اپلیکیشن یک حساب کاربری داشته باشند. همچنین، از آنجایی که می‌خواهیم این سیستم ناشناس و محرمانه باشد، این حساب کاربری نباید به هیچ عنوان به اطلاعات حقیقی کاربر یا هویت واقعی او ارتباط پیدا کند. بنابراین، می‌توانیم از روشی که در بخش گذشته توضیح دادیم استفاده کنیم تا چنین حساب کاربری‌ای را بسازیم.

### 3.1 ایجاد کلیدهای دیجیتالی مرتبط با هویت دیجیتال محرمانه

حالا کاربر باید یک جفت کلید برای مدیریت هویت دیجیتال خود تولید کند. اثبات صلاحیت کاربر به هویت دیجیتال ایجاد شده متصل خواهد شد و کلیدها برای تأیید اقدامات کاربر در قراردادهای هوشمند استفاده خواهند شد. می‌توانید این را به عنوان یک گواهی صادر شده توسط کاربر تصور کنید که حقوق نمایندگی او را در لایه بلاکچین تفویض می‌کند (چون بلاکچین از رمزنگاری مختلفی استفاده می‌کند).

برای اهداف مذکور (و حفاظت در برابر حملات مرد میانی)، کاربر باید تأیید کند که کلید تعریف شده را تولید و کنترل می‌کند. و برای این کار مجدداً از پاسپورت یا یک فرآیند احراز هویت فعال استفاده می‌کنند.

این فرآیند شامل ایجاد یک چالش (یک رشته با طول ثابت) و امضای آن با کلید خصوصی ذخیره شده در بخش امن پاسپورت است. کلید عمومی متناظر در DG15 قرار دارد. به جای چالش، کاربر شناسه دیجیتال (DID) تولید شده را ارائه می‌دهد و از پاسپورت می‌خواهد آن را امضا کند. می‌توانید این را به عنوان یک گواهی PK خود امضا شده با استفاده از کلید خصوصی پاسپورت در نظر بگیرید.

بنابراین، هنگامی که DID به یک مصرف‌کننده خارجی (مانند ارائه‌دهنده هویت یا قرارداد هوشمند) منتقل می‌شود، تأیید کننده مطمئن خواهد بود که کاربر کلیدهای هویت را کنترل می‌کند. DID براساس استاندارد Iden3 تولید می‌شود.

<img src="images/tech-doc-en/2.png"/>

### 3.2 تولید اثبات صلاحیت

هنگامی که یک پروفایل محلی رأی‌گیری ایجاد شد، باید به اعتبارنامه‌های قابل تأیید عمومی متصل شود که قراردادهای زنجیره‌ای بتوانند بدون افشای داده‌های شخصی تأیید کنند. ما تأیید صلاحیت را به صورت زیر تعریف می‌کنیم:

1. تأیید اینکه پاسپورت توسط یکی از مراجع مجاز صادر شده است (تأیید امضای SOD).
2. بررسی اینکه گروه DG1 شامل یک فیلد با شهروندی خاص است.
3. بررسی اینکه گروه DG1 شامل یک فیلد با تاریخ تولد که معیارهای لازم (18+) را برآورده می‌کند.
4. بررسی اینکه پاسپورت منقضی نشده است.
5. تأیید اینکه DG1، که داده‌های شخصی را نگه می‌دارد، و DGها، که داده‌های بیومتریک را نگه می‌دارند، در SOD گنجانده شده‌اند.
6. تأیید اینکه DG15 در SOD گنجانده شده است و کاربر از کلید خصوصی صحیح برای امضای DID استفاده کرده است (کنترل پاسپورت).

این تأییدات می‌تواند با استفاده از قراردادهای زنجیره‌ای اجرا شود. با این حال، این رویکرد به معنای عمومی شدن برخی از داده‌ها خواهد بود و تولید اثبات‌های لازم برای این فرآیند می‌تواند برای دستگاه‌های کاربر چالش‌برانگیز باشد. در عوض، کاربران باید با ارائه‌دهندگان هویت سیستم برای تکمیل فرآیند تأیید مورد نیاز تعامل داشته باشند. مهم است که این کار به گونه‌ای انجام شود که هیچ اطلاعات حساس، شخصی یا قابل ردیابی فاش نشود.

برای این کار، کاربر یکی از ارائه‌دهندگان را انتخاب می‌کند و مجموعه‌ای از داده‌ها را برای تأیید به آن‌ها ارسال می‌کند:

- DID + امضای تولید شده توسط کلید خصوصی پاسپورت.
- کلید عمومی احراز هویت (DG15).
- SOD.
- اثبات صلاحیت:
  - اثبات دانش صفر از شهروندی که در DG1 گنجانده شده است.
  - اثبات دانش صفر اینکه کاربر بالای 18 سال است (بسته به پارامترهای رأی‌گیری).
  - اثبات دانش صفر اینکه تاریخ انقضای در DG1 برآورده نشده است:
    - کاربر می‌تواند تاریخ انقضای پاسپورت را به ارائه‌دهنده هویت افشا کند تا اعتبارنامه قابل تأیید با همان تاریخ انقضا دریافت کند.
    - اگر کاربر نمی‌خواهد تاریخ انقضای پاسپورت را افشا کند - می‌تواند اثبات کند که زمان انقضا کمتر از مقداری خاص تعیین شده توسط ارائه‌دهنده هویت است. در نتیجه - کاربر اعتبارنامه قابل تأیید با تاریخ انقضای معادل دریافت خواهد کرد.
  - امضای SOD و گواهینامه امضا کننده سند (CDS).

<img src="images/tech-doc-en/3.png"/>



با استفاده از این فرآیند، کاربر می‌تواند اثبات صلاحیت خود را ایجاد کرده و با استفاده از آن در سیستم رأی‌گیری شرکت کند. در بخش‌های بعدی، به نحوه استفاده از این اثبات‌ها برای شرکت در رأی‌گیری و تأیید صحت رأی‌ها خواهیم پرداخت.

---

### 4. دریافت اعتبارنامه قابل تأیید (Verifiable Credential)

پس از دریافت مجموعه داده‌های مذکور، ارائه‌دهنده هویت فرآیند تأیید را آغاز می‌کند. اگر تمامی بررسی‌ها به درستی انجام شود، ارائه‌دهنده هویت اعتبارنامه قابل تأیید (VC) را براساس استانداردهای W3C به کاربر صادر می‌کند. این VC شامل موارد زیر است:

- مقادیر هش Poseidon پوشیده از DG2 و DG7 (با نمک تولید شده توسط ارائه‌دهنده هویت).
- ارائه‌دهنده هویت مقدار نمک را ذخیره می‌کند، اما مقدار هش نمک باید عمومی و قبل از صدور VCها منتشر شود.
- اگر مقدار نمک فاش شود، ممیز خارجی قادر خواهد بود تشخیص دهد کدام کاربران در سامانه ثبت‌نام کرده‌اند.
- اگر ارائه‌دهنده هویت مقدار نمک را از دست بدهد، نمی‌تواند صلاحیت تمام اعتبارنامه‌های صادر شده را اثبات کند.
- تاریخ انقضای اعتبارنامه.

این داده‌ها بر روی دستگاه کاربر ذخیره می‌شود. همزمان، ارائه‌دهنده هویت نیز داده‌های زیر را ذخیره می‌کند:

- داده‌های SOD.
- مقادیر هش Poseidon از DG2 و DG7.
- مقدار نمک.
- امضای SOD که توسط مرجع صدور گواهینامه تولید شده است.
- گواهینامه امضا کننده سند (CDS).
- اثبات صلاحیت.

<img src="images/tech-doc-en/4.png"/>


به عنوان یک پلتفرم پایه برای صدور اعتبارنامه‌های قابل تأیید، ما استفاده از پروتکل Rarimo را پیشنهاد می‌دهیم. این پروتکل به صدور VCها با قابلیت انتقال آن‌ها به بلاکچین مورد نیاز در آینده اجازه می‌دهد. این ویژگی اساسی است زیرا سازمان‌دهنده رأی‌گیری نمی‌داند که فرآیند نهایی رأی‌گیری کجا انجام خواهد شد اما می‌خواهد به کاربران اجازه دهد از قبل ثبت‌نام کنند. Rarimo امکان انتقال وضعیت هویت جهانی را با یک پیام بین‌زنجیره‌ای فراهم می‌کند، اما هر VC را جداگانه منتقل نمی‌کند. همزمان، فرآیند کاملاً غیرمتمرکز است - فقط نیاز به امضای پیام توسط حد نصاب اعتبارسنجان Rarimo برای تایید آن در شبکه مقصد دارد.

روش مذکور امکان ساخت استخرهای رأی‌گیری انعطاف‌پذیر را با جداسازی فرآیندهای مختلف و دریافت بیشترین ارزش از ترکیب فناوری‌ها و شبکه‌ها فراهم می‌کند (برخی از آن‌ها می‌توانند فرصت‌های منحصربه‌فردی برای سازماندهی فرآیند رأی‌گیری دقیقاً بر روی پشته فنی خود ارائه دهند - مانند کمک‌های مالی و غیره).

---
### 5. قراردادهای هوشمند

قراردادهای هوشمند برنامه‌های کامپیوتری هستند که بر روی بلاکچین اجرا می‌شوند و به طور خودکار شرایط یک قرارداد را اجرا می‌کنند. این قراردادها بدون نیاز به واسطه‌های متمرکز مانند بانک‌ها یا دفاتر اسناد رسمی، به طور خودکار تراکنش‌ها را مدیریت و اجرا می‌کنند. بلاکچین، یک دفتر کل توزیع‌شده است که به صورت غیرمتمرکز داده‌ها را ذخیره و مدیریت می‌کند، و قراردادهای هوشمند بر روی این دفتر کل اجرا می‌شوند.

#### نحوه کارکرد قراردادهای هوشمند

1. **ایجاد قرارداد:** قراردادهای هوشمند توسط برنامه‌نویسان ایجاد و به زبان‌های برنامه‌نویسی خاصی مانند Solidity (برای بلاکچین اتریوم) نوشته می‌شوند. این قراردادها شامل شرایط و مقررات قرارداد و اقداماتی است که در صورت برآورده شدن شرایط اجرا خواهند شد.
2. **انتشار در بلاکچین:** پس از ایجاد، قرارداد هوشمند بر روی بلاکچین منتشر می‌شود. این قراردادها به صورت دائمی در بلاکچین ذخیره می‌شوند و هر کسی می‌تواند به آنها دسترسی داشته باشد.
3. **اجرا:** هنگامی که شرایط مشخص شده در قرارداد هوشمند برآورده شوند، قرارداد به صورت خودکار اجرا می‌شود. مثلاً، اگر شرایط قرارداد پرداخت به یک فرد خاص باشد، پس از تحقق شرایط، مبلغ به صورت خودکار به حساب آن فرد منتقل می‌شود.
4. **مزایا:**
   - **شفافیت:** تمام تراکنش‌ها و قراردادها به صورت عمومی در بلاکچین قابل مشاهده هستند.
   - **امنیت:** قراردادهای هوشمند از رمزنگاری برای اطمینان از صحت و امنیت داده‌ها استفاده می‌کنند.
   - **کاهش هزینه‌ها:** قراردادهای هوشمند نیاز به واسطه‌ها را حذف می‌کنند و هزینه‌های مرتبط با آنها را کاهش می‌دهند.

#### تأیید اعتبار اثبات‌های ZKP در قراردادهای هوشمند

یکی از کاربردهای قراردادهای هوشمند، تأیید اعتبار اثبات‌های دانش صفر (ZKP) است. ZKP روشی برای اثبات یک بیانیه بدون افشای اطلاعات اضافی است. در سیستم رأی‌گیری الکترونیکی ما، می‌توانیم از قراردادهای هوشمند برای تأیید اعتبار اثبات‌های ZKP استفاده کنیم. این قراردادها می‌توانند به طور خودکار بررسی کنند که آیا اثبات‌های ارائه شده توسط کاربران معتبر هستند یا خیر، بدون اینکه اطلاعات شخصی کاربران فاش شود.

برای مطالعه بیشتر در مورد قراردادهای هوشمند و بلاکچین، می‌توانید به لینک‌های زیر مراجعه کنید:

- [قرارداد هوشمند در ویکی‌پدیا](https://en.wikipedia.org/wiki/Smart_contract)
- [مقدمه‌ای بر قراردادهای هوشمند](https://www.investopedia.com/terms/s/smart-contracts.asp)
- [بلاکچین و نحوه کارکرد آن](https://www.investopedia.com/terms/b/blockchain.asp)
- [آموزش قراردادهای هوشمند اتریوم](https://ethereum.org/en/developers/docs/smart-contracts/)

---

### ایجاد استخر رأی‌گیری

در این بخش، به ایجاد یک نمونه استخر رأی‌گیری می‌پردازیم که شامل مجموعه‌ای از قراردادها است که فرآیند کامل رأی‌گیری را ممکن می‌سازد. این شامل موارد زیر است:

- ایجاد استخر پاداش برای تسهیل‌کنندگان تراکنش‌ها.
- ثبت‌نام در رجیستری رأی‌گیری.
- تسهیل رأی‌گیری ناشناس.
- محاسبه نتایج.

#### 5.1 اجزای زیرساخت قرارداد رأی‌گیری

با استفاده از رویکرد زیرساختی پیش‌فرض (که در مقاله توضیح داده شده است)، هر کسی می‌تواند یک استخر ایجاد کند (پیاده‌سازی خاص ممکن است متفاوت باشد). سازنده باید روش کارخانه استخر را فراخوانی کند و پارامترهای لازم را وارد کند. فراخوانی این روش منجر به ایجاد ۳ سیستم قراردادی می‌شود:

- **قرارداد سرمایه‌گذاری در رأی‌گیری (INV):** برای جمع‌آوری وجوه به منظور جبران هزینه‌های نودهای تسهیل‌کننده تراکنش‌ها استفاده می‌شود (به بخش ۶ مراجعه کنید).
- **قرارداد ثبت‌نام رأی‌دهندگان در استخر (REG):** برای تایید مالکیت کاربر بر اعتبارنامه‌های لازم و افزودن یک موجودیت ناشناس به رجیستر رأی‌دهندگان استفاده می‌شود.
- **قرارداد رأی‌گیری (VOT):** برای ارسال رأی‌های ناشناس و شمارش نتایج رأی‌گیری استفاده می‌شود.

<img src="images/tech-doc-en/5.png"/>

> توجه: رویکرد کلی به زیرساخت قراردادها در بالا ارائه شده است. برخی پیاده‌سازی‌ها می‌توانند متفاوت باشند (به عنوان مثال، ممکن است یک قرارداد با روش‌های مختلف برای عملکردهای توضیح داده شده وجود داشته باشد).

#### 5.2 پارامترهای رأی‌گیری

برای آغاز ایجاد قراردادها، نیاز به تعریف پارامترهای زیر دارید:

- **بازه زمانی برای عملکرد هر یک از قراردادها:** این مهم است که بفهمید قراردادها در مراحل مختلف رأی‌گیری درگیر هستند و به ترتیب INV->REG->VOT->INV اجرا می‌شوند. در پایان هر مرحله، یک شرط می‌تواند قرارداد را از شرکت در مرحله بعدی مسدود کند.
- **حداکثر و حداقل تعداد رأی‌دهندگان:** حداقل تعداد رأی‌دهندگان لازم برای تصمیم‌گیری مشخص می‌شود (تعداد احزاب ثبت‌شده ممکن است بیشتر از تعداد رأی‌دهندگان واقعی باشد).
- **هزینه متوسط تراکنش‌های تعامل با قراردادها:** ثبت‌نام در استخر و رأی‌گیری.
- **نرخ پاداش تسهیل‌کنندگان:** این پارامتر بسته به مقدار سرمایه‌گذاری در INV و تعداد رأی‌دهندگان قابل تنظیم است.
- **گزینه‌های رأی‌گیری و دیگر تنظیمات (شامل گزینه‌های چند انتخابی).**
- **لیست ارائه‌دهندگان هویت معتبر که می‌توانند اعتبارنامه‌های لازم را به رأی‌دهندگان صادر و صلاحیت آنها را تایید کنند.**
- **انواع اعتبارنامه‌ها (schemas).**

#### 5.3 فرایند ایجاد قراردادها

مقادیر نرم‌کپ و هارد کپ کمپین تامین مالی جمعی در قرارداد سرمایه‌گذاری (INV) بر اساس پارامترهای از پیش تعیین شده تعیین می‌شود. وقتی تاریخ شروع کمپین فرا می‌رسد، سرمایه‌گذاران می‌توانند وجوه خود را با استفاده از یک روش خاص به قرارداد INV واریز کنند. این وجوه سپس به طور خودکار بین استخرهای مختلف بر اساس نسبت هزینه‌های تراکنش تخصیص داده می‌شوند.

اگر نرم‌کپ تا پایان کمپین تأمین نشود، قرارداد REG (ثبت‌نام) ایجاد نمی‌شود و سرمایه‌گذاران (تأمین‌کنندگان کمپین) وجوه خود را پس می‌گیرند. با این حال، اگر نرم‌کپ تأمین شود (یا هاردکپ زودتر تأمین شود)، هر کسی می‌تواند ایجاد قرارداد REG را آغاز کند.

از تاریخ شروع ثبت‌نام، کاربران (مستقیم یا از طریق تسهیل‌کنندگان) می‌توانند از یک روش برای افزودن خود به لیست رأی‌گیری به صورت ناشناس استفاده کنند. در طول این فرآیند، پارامترهای محرمانه‌ای را تعیین می‌کنند که بعداً شامل آنها در لیست را تأیید می‌کند. نتیجه این مرحله یک لیست ناشناس از رأی‌دهندگان ثبت‌شده است. اگر تعداد کاربران ثبت‌شده کمتر از حداقل آستانه باشد، استقرار قرارداد رأی‌گیری واقعی (VOT) متوقف می‌شود تا از خطرات احتمالی عدم ناشناس بودن جلوگیری شود. با این حال، بر اساس تعداد تراکنش‌های تایید شده، تسهیل‌کنندگان همچنان می‌توانند از قرارداد INV درخواست بازپرداخت کنند.

قرارداد VOT در صورتی که حداقل آستانه کاربران ثبت‌شده تأمین شود، مستقر می‌شود (همانطور که قبلاً ذکر شد، هر کاربری می‌تواند این فرآیند را تنها در صورت برآورده شدن شرایط آغاز کند). از طریق این قرارداد، کاربران می‌توانند با اثبات ثبت‌نام رأی دهند. قرارداد VOT همچنین شمارش نهایی آراء را انجام می‌دهد. یک گزینه برای مخفی نگه‌داشتن نتایج تا پایان فرآیند رأی‌گیری وجود دارد که نیاز به تنظیمات مورد اعتماد برای رمزنگاری آراء با یک کلید آستانه دارد، اما این گزینه اختیاری است.

#### 5.4 چگونه کاربر استخر مورد نیاز را پیدا می‌کند؟

برای ارائه اطلاعات درباره استخر رأی‌گیری به کاربر، کافی است آدرس قرارداد اصلی و شناسه استخر (به عنوان مثال، به صورت یک کد QR) ارائه شود. اپلیکیشن رأی‌گیری باید رابط صحیحی برای ارتباط با روش‌های مناسب قرارداد پشتیبانی کند.

---

### 6. تسهیل‌کنندگان تراکنش (Relayers)

در شرایطی که می‌خواهیم از سیستم‌های غیرمتمرکز استفاده کرده و حق رأی‌دهی را به همه افراد واجد شرایط ارائه دهیم، با مجموعه‌ای از چالش‌ها روبرو هستیم که باید حل شوند:

- کاربران باید اقداماتی قابل حسابرسی و محافظت‌شده انجام دهند که زمان‌بندی شده و قابل حذف یا تغییر نیستند. این امکان با بلاکچین‌های عمومی و استفاده از تراکنش‌ها با فراخوانی‌های قرارداد هوشمند مناسب وجود دارد.
- کاربران نمی‌خواهند (یا نمی‌توانند) هزینه تراکنش را پرداخت کنند. علاوه بر این، بسیاری از کاربران (اکثریت) از بلاکچین آگاهی ندارند - نصب کیف پول‌های رمزنگاری و خرید ارز بومی یک مانع اضافی برای آنهاست.
- برخی از خدمات می‌توانند تراکنش‌ها را به جای کاربران ارسال کنند (اما نمی‌توانند امضاها یا اثبات‌ها را تغییر دهند). ایجاد یک سرویس تسهیل‌کننده تراکنش واحد ممکن است، اما غیرقابل اعتماد است (احتمال بالای حملات DoS).
- اجازه دادن به هر علاقه‌مندی برای انتقال تراکنش‌های کاربران امکان‌پذیر است. اما بدیهی است که این تسهیل‌کنندگان نمی‌خواهند هزینه کسی دیگر را پرداخت کنند اگر سودآور نباشد.

در حالی که تسهیل‌کنندگان غیرمتمرکز نویدبخش به نظر می‌رسند، یک سوال مهم مطرح می‌شود: آیا می‌توانیم یک طرحی ایجاد کنیم که در آن خدمات واسطه‌ای هنگام تأیید تراکنش‌های کاربران پاداش یا مزایایی دریافت کنند؟

همزمان، برخی سازمان‌ها (که در ادامه آنها را سرمایه‌گذاران می‌نامیم) می‌توانند تحت شرایط زیر کمک‌های مالی ارائه دهند:

- سرمایه‌گذاران باید به شدت علاقه‌مند به مشارکت در فعالیت‌های کاربران نهایی باشند، به ویژه در فرآیندهایی که از طریق رأی‌گیری مخاطبان زیادی را جذب می‌کنند.
- آنها باید اطمینان حاصل کنند که وجوهی که فراهم می‌کنند به صورت عادلانه و متناسب با مشارکت تسهیل‌کنندگان تخصیص می‌یابد.
- علاوه بر این، سرمایه‌گذاران باید بتوانند تأیید کنند که تسهیل‌کنندگان فقط برای انجام اقدامات مناسب پاداش می‌گیرند، مانند تأیید تراکنش‌های معتبر که روش‌های خاصی از قرارداد هوشمند را فعال می‌کنند، و این تأیید باید فقط پس از تأیید این اقدامات انجام شود.

سرمایه‌گذاران، که در این سناریو به عنوان تأمین‌کنندگان مالی جمعی عمل می‌کنند، آماده‌اند تا حمایت مالی ارائه دهند با این پیش‌بینی که یک رویداد رأی‌گیری عادلانه را تسهیل کنند. برای رفع این چالش، ضروری است که یک راه‌حل توسعه یابد که به همه طرف‌های درگیر - کاربران، خدمات واسطه‌ای و سرمایه‌گذاران - اجازه دهد از مشارکت خود در این چرخه متصل ارزش بگیرند.

بیایید ببینیم که چگونه این فرآیند به عنوان یک جزء از ابزار رأی‌گیری ما کار می‌کند.

#### 6.1 تشویق تسهیل‌کنندگان تراکنش

پیش‌نیازها:

- یک رویداد رأی‌گیری وجود دارد که در آن می‌خواهیم تعداد زیادی رأی‌دهنده (نه تنها وب۳) داشته باشیم.
- قرارداد رأی‌گیری در بلاکچین عمومی وجود دارد و هر تراکنش با رای نیاز به پرداخت هزینه دارد.
- تعداد تقریبی کاربران را می‌دانیم - “تعداد پیش‌بینی‌شده رأی‌دهندگان (EXPECTED_NUM_VOTERS)”.
- قیمت متوسط رای را می‌دانیم - “قیمت متوسط رای (AVG_VOTE_PRICE)”.
- در صورت انتخابات بزرگ، می‌تواند عملکرد کلی شبکه مربوطه را تحت تاثیر قرار داده و قیمت متوسط رای را افزایش دهد (با رقابت برای جایگاه در بلاک).
- علاوه بر این، می‌توان یک ضریب تنظیم کرد - که سودآوری تأیید رأی خاص توسط تسهیل‌کننده را نمایش می‌دهد “ضریب تشویقی (INCENTIVE_COEFF)”.

راه‌حل برای تسهیل‌کنندگان به شرح زیر کار می‌کند:

1. **ایجاد استخر پاداش:** فرآیند با ایجاد استخر پاداش آغاز می‌شود که بین تسهیل‌کنندگان توزیع خواهد شد. پارامترهای زیر برای ایجاد استخر استفاده می‌شوند:
   - تاریخ و زمان شروع رأی‌گیری (یا تاریخ و زمان ثبت‌نام اگر وجود داشته باشد).
   - سقف نرم = تعداد پیش‌بینی‌شده رأی‌دهندگان * قیمت متوسط رأی * ضریب تشویقی.
   - حداقل مبلغ وجوه لازم برای شروع فرآیند رأی‌گیری.
   - سقف سخت (در صورت نیاز).
   - حداکثر مبلغ وجوه لازم برای شروع فرآیند رأی‌گیری.
   - پارامترهای قرارداد رأی‌گیری (آدرس قرارداد، نام روش‌ها، و غیره).

سپس سرمایه‌گذاران می‌توانند وجوه خود را به استخر واریز کنند اگر با تمامی داده‌های تعریف شده موافق باشند. فرآیند اهدا مانند یک کمپین تأمین مالی جمعی است: رأی‌گیری تنها در صورت رسیدن به سقف نرم آغاز می‌شود. اگر سقف نرم در طول فرآیند رأی‌گیری تامین نشود، وجوه به حساب‌های سرمایه‌گذاران بازگردانده می‌شود.

<img src="images/tech-doc-en/6.png"/>

2. **شروع فرآیند رأی‌گیری:** وقتی فرآیند رأی‌گیری شروع می‌شود، کاربران رأی‌های معتبر (که می‌توانند ناشناس باشند) با امضاها/اثبات‌ها تولید کرده و آنها را به تسهیل‌کنندگان ارسال می‌کنند. آنها می‌توانند رأی‌ها را به تسهیل‌کنندگان از پیش تعریف شده که به آنها اعتماد دارند ارسال کنند یا اثبات‌ها را به شبکه ذخیره‌سازی غیرمتمرکز ارسال کنند، جایی که هر تسهیل‌کننده‌ای می‌تواند آنها را برداشته و در نهایت به بلاکچین ارسال کند.
<img src="images/tech-doc-en/7.png"/>

3. **توزیع پاداش:** در این شرایط، برای تسهیل‌کنندگان سودآور نیست که منتظر بمانند تا بتوانند حداکثر ارزش استخراج‌شده (MEV) را بر اساس هزینه تایید تراکنش دریافت کنند اگر هزینه فعلی کمتر از پاداشی باشد که از استخر سرمایه‌گذاری دریافت می‌کنند (این مبلغ برای همه واضح و قابل مشاهده است). هر نودی که تراکنش را ارسال کند - سود دریافت می‌کند.
   - تسهیل‌کنندگان می‌توانند با یکدیگر رقابت کنند - اشکالی ندارد. مهم‌ترین چیز وجود حداقل یک نود است که می‌تواند ارزش را از تراکنش تأیید شده استخراج کند.
   - تئوراً، تسهیل‌کنندگان می‌توانند توافق کنند، فقط یک تراکنش را تایید کرده و درآمد را بین همه تسهیل‌کنندگان تقسیم کنند (بدون پرداخت هزینه). با این حال، نمی‌توانند به یکدیگر اعتماد کنند که کسی دیگر تراکنش‌های دیگر را تایید نکند و سهم خود را در استخر افزایش ندهد.
   - در طول رأی‌گیری، ارسال تراکنش‌ها برای تسهیل‌کنندگان غیر سودآور می‌شود زیرا کل پاداش استخر کمتر از کل هزینه گاز تراکنش‌ها است. پروکسی‌ها ممکن است به ارسال تراکنش‌ها برای به دست آوردن سهم بیشتر و کاهش ضرر ادامه دهند. اما بهتر است یک ضریب تشویقی (INCENTIVE_COEFF) پایه داشته باشید که منطقی و به درستی محاسبه شده باشد.
   - هر پروکسی یک استراتژی برای چگونگی و زمان ارسال تراکنش‌ها برای استخراج حداکثر ارزش ایجاد می‌کند. اما بهتر است منتظر نمانید - هر تراکنش تأیید شده سهم در استخر را افزایش می‌دهد و به طور بالقوه به پاداش‌های بیشتر منجر می‌شود.
4. **پایان فرآیند رأی‌گیری:** پس از پایان فرآیند رأی‌گیری، استخر پاداش بین تمام حساب‌هایی که در طول فرآیند رأی‌گیری تراکنش‌ها را ارسال کرده‌اند توزیع می‌شود. اندازه سهم بستگی به تعداد تراکنش‌های ارسال شده دارد.
   - هر تسهیل‌کننده باید ادعای پاداش خود را آغاز کند، اما قرارداد می‌تواند به صورت خودکار محاسبه کند که کدام حساب‌های خارجی (EOAs) تراکنش‌های لازم را ارسال کرده‌اند.

<img src="images/tech-doc-en/8.png"/>

همچنین توضیحات کلی در مورد نحوه بازپرداخت عملیات وب۳ وجود دارد. اما گاهی اوقات تعداد تراکنش‌ها در یک فرآیند بیش از یک تراکنش است. برای مثال، راه‌حل توصیف شده نیاز به مراحل زیر دارد:

- تراکنش برای ایجاد VC (ممکن است توسط ارائه‌دهندگان هویت پرداخت شود).
- تراکنش برای ثبت‌نام در استخر رأی‌گیری (باید توسط تسهیل‌کنندگان ارسال شود).
- تراکنش با رای (همچنین باید توسط تسهیل‌کنندگان ارسال شود).

هزینه تراکنش‌ها در مراحل مختلف متفاوت است، بنابراین تقسیم استخر به دو زیر استخر با توجه به نوع تراکنش‌های ارسال شده توسط تسهیل‌ کنندگان منطقی است.

---
### 7. ثبت‌نام به عنوان رأی‌دهنده در استخر

این روش برای ناشناس‌سازی رأی‌های کاربران استفاده می‌شود، به‌طوری که در نهایت هیچ‌کس نمی‌تواند تراکنش‌های اضافه شده به لیست رأی‌گیری را با تراکنش‌های رأی مرتبط کند. برای افزودن یک کاربر به رجیستری، مراحل زیر را دنبال کنید:

1. **تولید مقادیر خصوصی:**
   - کاربر دو مقدار خصوصی تولید می‌کند: Nullifier و Secret.
   - کاربر شناسه‌ای به نام Identifier را محاسبه می‌کند که از فرمول Poseidon(Nullifier, Secret) به دست می‌آید.

2. **ارسال اثبات صلاحیت رأی‌دهی:**
   - کاربر اثبات صلاحیت رأی‌دهی خود (اعتبارنامه معتبر و غیر منقضی) و لیست داده‌های زیر را ارسال می‌کند:
     - مقادیر هش Poseidon نمک‌دار از DG2 و DG7. این داده‌ها برای بررسی یکتایی کاربر لازم است و می‌توانند به عنوان اثبات ضد تقلب استفاده شوند اگر کسی بخواهد رای کاربر را خراب کند.
     - اثبات اینکه مقادیر هش مذکور در VC گنجانده شده‌اند.

3. **افزودن شناسه به لیست درخت Merkle:**
   - همزمان، کاربر شناسه‌ای را ارائه می‌دهد که به لیست درخت Merkle اضافه می‌شود (اگر تمام تأییدها گذرانده شوند).
   - مقادیر هش Poseidon نمک‌دار از DG2 و DG7 در قرارداد ذخیره می‌شوند و اجازه نمی‌دهند کاربر دوباره ثبت‌نام کند.
   - درخت Merkle به‌روزرسانی می‌شود.
<img src="images/tech-doc-en/9.png"/>

در این مرحله، مهم است که کاربر مقادیر Nullifier و Secret را به‌طور امن در دستگاه خود ذخیره کند. این مقادیر به کاربر امکان رأی‌دادن در مرحله نهایی را می‌دهند. همچنین، مهم است که وقتی یک برگ به درخت اضافه شد، کاربر می‌تواند تمام داده‌های مرتبط با پاسپورت خود را پاک کند. علاوه بر این، برای مرحله نهایی رأی‌گیری، کاربر می‌تواند از یک دستگاه دیگر استفاده کند که هیچ‌گاه به داده‌های پاسپورت دسترسی نداشته باشد. تنها شرط لازم برای این مرحله نهایی، دانش از مقادیر Nullifier و Secret است.

---
### 8. اثبات صحت پاسپورت

برخی از بازرسان ممکن است با ادعای صدور اعتبارنامه‌های نامعتبر توسط ارائه‌دهنده هویت، سعی کنند انتخابات را بی‌اعتبار کنند (مثلاً دولت ادعا می‌کند که ارائه‌دهنده هویت اعتبارنامه‌هایی به کاربران صادر کرده که حق رأی دادن ندارند). در این مورد، یک روش برای اثبات توسط ارائه‌دهنده هویت وجود دارد که فرآیند تأیید پاسپورت برای یک لیست خاص از شناسه‌های منحصر به فرد در VCها انجام شده است.

#### فرآیند اثبات

1. **بیانیه بازرس:** بازرس ادعا می‌کند که ارائه‌دهنده هویت قوانین پروتکل را نقض کرده است.
2. **انتخاب شناسه‌ها:** بازرس به صورت تصادفی یک مجموعه از شناسه‌های منحصر به فرد ذخیره شده در رجیستر رأی‌گیری را انتخاب می‌کند. موقعیت شناسه‌ها می‌تواند به هر شکل توسط بازرس انتخاب شود.
   - بازرس می‌تواند درخواست شواهد برای همه شناسه‌ها کند، به این ترتیب تضمین 100٪ اعتبار همه رأی‌دهندگان فراهم می‌شود. با این حال، فرآیند تولید شواهد در این حالت بسیار وقت‌گیر خواهد بود و ارائه‌دهنده هویت می‌تواند “آستانه احتمال” را برای آزمون تعیین کند.
3. **ارسال شناسه‌ها:** بازرس یک آرایه از شناسه‌ها را به ارائه‌دهنده هویت ارسال می‌کند.
4. **تولید شواهد:** برای هر یک از شناسه‌ها، ارائه‌دهنده هویت یک اثبات تولید می‌کند:
   - **ورودی‌های عمومی:** zk_hash(salt || hash (DG2)), CDS, hash(salt).
   - **ورودی‌های خصوصی:** امضای SOD، SOD، نمک، هش (DG2).
   - **اثبات‌ها:**
     - اثبات صلاحیت (توسط کاربر تولید شده است).
     - اثبات اینکه هش نمک برابر با hash(salt) است.
     - اثبات اینکه هش DG2 در SOD گنجانده شده و zk_hash(salt || hash (DG2)) برابر با شناسه منحصر به فرد است.
     - اثبات اینکه امضای CDS و SOD صحیح است.
5. **بررسی شواهد:** بازرس بدنه شواهد را بررسی می‌کند:
   - اگر حداقل یکی از شواهد به درستی تشکیل نشده باشد، ارائه‌دهنده هویت آزمون را رد می‌کند (بی‌اعتباری موفقیت‌آمیز).
   - اگر همه شواهد صحیح باشد، ارائه‌دهنده هویت قوانین پروتکل را نقض نکرده و همه رأی‌دهندگان معتبر هستند.
  <img src="https://freedomtool.org/images/tech-doc-en/10.png"/>

---
### 9. فرآیند رأی‌دهی

برای ارسال رای، کاربر باید اقدامات زیر را انجام دهد:

1. **تشکیل بدنه رای:** کاربر بدنه رای را که نمایانگر گزینه انتخابی اوست، تشکیل می‌دهد.
2. **محاسبه شاخه Merkle:** کاربر شاخه Merkle را برای برگی که به دلیل ثبت‌نام کاربر اضافه شده است، محاسبه می‌کند.
3. **محاسبه اثبات دانش صفر:**
   - **ورودی‌های عمومی:** Nullifier، Merkle Root، و Vote.
   - **ورودی‌های خصوصی:** Identifier، Merkle Branch، و Secret.
   - **منطق تایید:**
     - Identifier == Poseidon(Nullifier, Secret);
     - قرار گرفتن Identifier در درخت Merkle با Root مربوطه با استفاده از Merkle Branch.
4. **ارسال رأی و اثبات به تسهیل‌کننده:** کاربر اثبات را همراه با بدنه رأی ارسال می‌کند و تسهیل‌کننده اثبات و رأی را به یک تراکنش تبدیل کرده و به شبکه ارسال می‌کند.
5. **تأیید توسط قرارداد VOT:** قرارداد VOT اثبات را تأیید می‌کند و اگر صحیح باشد، رأی را در نظر می‌گیرد.

<img src="images/tech-doc-en/9.png"/>

> توجه: پارامتر Vote به صورت مستقیم در فرآیند تأیید مشارکت نمی‌کند. این پارامتر یک محدودیت اضافه می‌کند و رأی را به اثبات پیوند می‌دهد. تغییر رأی باعث نامعتبر شدن کل اثبات می‌شود. در غیر این صورت، افراد مخرب می‌توانند اثبات را رهگیری کرده و رأی را با رأی جدید جایگزین کنند.

#### ۹.۱ محاسبه نتایج

وضعیت قرارداد هوشمند مربوطه نتایج رأی‌گیری را ذخیره می‌کند. اگر از بلاکچین بدون مجوز به عنوان زیرساخت برای استخر استفاده شود، این بدان معناست که هر کسی می‌تواند آن را بررسی کند و مطمئن شود که نتیجه نهایی با تمام تراکنش‌های انجام شده مطابقت دارد.

یک حالت وجود دارد که اجازه می‌دهد نتایج رأی‌گیری قبل از اتمام مخفی بمانند. این روش نیاز به یک تنظیمات مورد اعتماد بین حد نصاب شرکت‌کنندگان دارد. این حد نصاب کلید عمومی برای رمزنگاری آراء توسط کاربران نهایی را تشکیل می‌دهد. وقتی فرآیند رأی‌گیری تمام می‌شود، این افراد می‌توانند اسرار خود را افشا کنند و هر کسی (اگر حد نصاب تأمین شود) می‌تواند آراء را رمزگشایی کرده و نتیجه نهایی رأی‌گیری را محاسبه کند.

اگر نتایج به صورت دائمی باز باشند، می‌توان منطق اضافی بر اساس وضعیت نهایی قرارداد رأی‌گیری ایجاد کرد، مثلاً راه‌اندازی یک اقدام خاص. گزینه رمزنگاری نیز ممکن است اما نیاز به یک راه‌حل پیچیده‌تر دارد، مانند رمزنگاری هم‌ریختی.

---
### ادعاها و مفروضات امنیتی

پروتکل شامل لیستی از ادعاها و فرضیات امنیتی است:

- تنها فردی که به صورت فیزیکی مالک پاسپورت بیومتریک است، می‌تواند مالکیت DID را تایید کند.
- تنها کاربران ثبت‌نام شده در قرارداد REG (با برگ‌های مناسب درخت) می‌توانند در رأی‌گیری شرکت کنند.
- ثبت‌نام و رأی‌گیری می‌تواند در دستگاه‌های جداگانه انجام شود (از طریق صادرات Nullifier و Secret). در این صورت، ترمینال رأی‌گیری هیچ اطلاعاتی درباره شخص ندارد جز اینکه او حق رأی دادن دارد.
- کاربران نمی‌توانند دوبار با استفاده از همان برگ درخت رأی دهند.
- کاربران نمی‌توانند با استفاده از همان هش‌های نمک‌دار هر اعتبارنامه بیومتریک یا با همان امضا از مرجع صدور گواهینامه در استخر ثبت‌نام کنند.
- اگر کلید احراز هویت در نسخه تکراری پاسپورت جایگزین شده باشد - مالک واقعی می‌تواند آن را اثبات کرده و مرجع صدور گواهینامه را بی‌اعتبار کند.
- رأی تنها با دانش از Nullifier و Secret مربوطه قابل ارسال است. اگر کاربر آن را از دست بدهد - هیچ راهی برای بازیابی رأی وجود ندارد.
- رأی نمی‌تواند ارسال شود اگر Nullifier یا Secret ناشناخته باشد.
- امکان جایگزینی بدنه رای در رای وجود ندارد در حالی که سازگاری اثبات حفظ می‌شود.
- هیچ راهی برای ردیابی ارتباط بین ثبت‌نام و رأی‌گیری وجود ندارد اگر از EOAs/relayers مختلف استفاده شده باشد.
- ارائه‌دهندگان هویت نمی‌توانند داده‌های شخصی کاربران را بدون دسترسی به پایگاه‌داده‌های مناسب بازیابی کنند (حمله دیکشنری).
- ارائه‌دهندگان هویت تنها زمانی می‌توانند به خطر بی افتند که VCs جعلی ایجاد کنند (یا مقدار نمک را از دست بدهند).

---
## لینک‌ها

[1] [Doc 9303 Machine Readable Travel Documents](https://www.icao.int/Security/FAL/PKD/Documents/APrimeronthePublicKeyDirectory(includeslanguageversion(s))/APrimeronthePublicKeyDirectory.pdf)

[2] [Iden3](https://iden3.io/)

[3] [W3C](https://www.w3.org/)

[4] [Rarimo](https://rarimo.com/)

[5] [Tornado Cash](https://en.wikipedia.org/wiki/Tornado_Cash)